diff -urN a/ssl/s3_pkt.c b/ssl/s3_pkt.c
--- a/ssl/s3_pkt.c	2014-06-06 13:15:41.337769000 -0500
+++ b/ssl/s3_pkt.c	2014-06-06 14:21:33.024541040 -0500
@@ -641,9 +641,6 @@
 	SSL3_BUFFER *wb=&(s->s3->wbuf);
 	SSL_SESSION *sess;
 
- 	if (wb->buf == NULL)
-		if (!ssl3_setup_write_buffer(s))
-			return -1;
 
 	/* first check if there is a SSL3_BUFFER still being written
 	 * out.  This will happen with non blocking IO */
@@ -659,6 +656,11 @@
 		/* if it went, fall through and send more stuff */
 		}
 
+	if (wb->buf == NULL)
+		if (!ssl3_setup_write_buffer(s))
+			return -1;
+
+
 	if (len == 0 && !create_empty_fragment)
 		return 0;
 
