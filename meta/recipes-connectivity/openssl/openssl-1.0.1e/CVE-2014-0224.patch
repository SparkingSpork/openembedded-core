diff -urN a/ssl/s3_clnt.c b/ssl/s3_clnt.c
--- a/ssl/s3_clnt.c	2013-02-11 09:26:04.000000000 -0600
+++ b/ssl/s3_clnt.c	2014-06-06 13:12:30.209515317 -0500
@@ -559,6 +559,7 @@
 		case SSL3_ST_CR_FINISHED_A:
 		case SSL3_ST_CR_FINISHED_B:
 
+			s->s3->flags |= SSL3_FLAGS_CCS_OK;
 			ret=ssl3_get_finished(s,SSL3_ST_CR_FINISHED_A,
 				SSL3_ST_CR_FINISHED_B);
 			if (ret <= 0) goto end;
@@ -916,6 +917,7 @@
 		SSLerr(SSL_F_SSL3_GET_SERVER_HELLO,SSL_R_ATTEMPT_TO_REUSE_SESSION_IN_DIFFERENT_CONTEXT);
 		goto f_err;
 		}
+	    s->s3->flags |= SSL3_FLAGS_CCS_OK;
 	    s->hit=1;
 	    }
 	else	/* a miss or crap from the other end */
diff -urN a/ssl/s3_pkt.c b/ssl/s3_pkt.c
--- a/ssl/s3_pkt.c	2013-02-11 09:26:04.000000000 -0600
+++ b/ssl/s3_pkt.c	2014-06-06 13:15:41.337769842 -0500
@@ -1297,6 +1297,15 @@
 			goto f_err;
 			}
 
+                if (!(s->s3->flags & SSL3_FLAGS_CCS_OK))
+                        {
+                        al=SSL_AD_UNEXPECTED_MESSAGE;
+                        SSLerr(SSL_F_SSL3_READ_BYTES,SSL_R_CCS_RECEIVED_EARLY);
+                        goto f_err;
+                        }
+ 
+                s->s3->flags &= ~SSL3_FLAGS_CCS_OK;
+
 		rr->length=0;
 
 		if (s->msg_callback)
diff -urN a/ssl/s3_srvr.c b/ssl/s3_srvr.c
--- a/ssl/s3_srvr.c	2013-02-11 09:26:04.000000000 -0600
+++ b/ssl/s3_srvr.c	2014-06-06 13:18:37.804776890 -0500
@@ -673,6 +673,7 @@
 		case SSL3_ST_SR_CERT_VRFY_A:
 		case SSL3_ST_SR_CERT_VRFY_B:
 
+                        s->s3->flags |= SSL3_FLAGS_CCS_OK;
 			/* we should decide if we expected this one */
 			ret=ssl3_get_cert_verify(s);
 			if (ret <= 0) goto end;
@@ -700,6 +701,7 @@
 
 		case SSL3_ST_SR_FINISHED_A:
 		case SSL3_ST_SR_FINISHED_B:
+                        s->s3->flags |= SSL3_FLAGS_CCS_OK;
 			ret=ssl3_get_finished(s,SSL3_ST_SR_FINISHED_A,
 				SSL3_ST_SR_FINISHED_B);
 			if (ret <= 0) goto end;
@@ -770,7 +772,10 @@
 				s->s3->tmp.next_state=SSL3_ST_SR_FINISHED_A;
 #else
 				if (s->s3->next_proto_neg_seen)
+                                        {
+                                        s->s3->flags |= SSL3_FLAGS_CCS_OK;
 					s->s3->tmp.next_state=SSL3_ST_SR_NEXT_PROTO_A;
+					}
 				else
 					s->s3->tmp.next_state=SSL3_ST_SR_FINISHED_A;
 #endif
diff -urN a/ssl/ssl3.h b/ssl/ssl3.h
--- a/ssl/ssl3.h	2013-02-11 09:26:04.000000000 -0600
+++ b/ssl/ssl3.h	2014-06-06 13:27:00.023483425 -0500
@@ -388,6 +388,7 @@
 #define TLS1_FLAGS_TLS_PADDING_BUG		0x0008
 #define TLS1_FLAGS_SKIP_CERT_VERIFY		0x0010
 #define TLS1_FLAGS_KEEP_HANDSHAKE		0x0020
+#define SSL3_FLAGS_CCS_OK                      0x0080
  
 /* SSL3_FLAGS_SGC_RESTART_DONE is set when we
  * restart a handshake because of MS SGC and so prevents us
